{% extends 'adminlte/base/base.html' %}
{% load static i18n %}
{% load humanize %}
{% load widget_tweaks %}
{% load auth_extras %}


{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/sweetalert2/sweetalert2.min.css' %}">
<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/toastr/toastr.min.css' %}">
<style media="screen">
  .img-150 {
    width: 150px;
    height: 150px;
    max-width: 150px;
    max-height: 150px;
    border: 1px solid #80b229;
    border-radius: 5px;
  }
  .img-200 {
    width: 200px;
    height: 200px;
    max-width: 200px;
    max-height: 200px;
    border: 1px solid #80b229;
    border-radius: 5px;
  }
</style>
{% endblock %}

{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0 text-dark">Detalle Activo: {{ object.codigo }}</h1>
      </div><!-- /.col -->
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="{% url 'devise-dashboard1' %}">Inicio</a></li>
          <li class="breadcrumb-item"><a href="{% url 'asset-admin-list' %}">Activo</a></li>
          <li class="breadcrumb-item active">{{ object.codigo }}</li>
        </ol>
      </div><!-- /.col -->
    </div><!-- /.row -->
  </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-9">
        <div class="card">
          <div class="card-header p-2">
            <ul class="nav nav-pills">
              <li class="nav-item"><a class="nav-link active" href="#general" data-toggle="tab">General</a></li>
              <li class="nav-item"><a class="nav-link" href="#documentos" data-toggle="tab">Documental</a></li>
              <li class="nav-item"><a class="nav-link" href="#arriendo" data-toggle="tab">Arriendo</a></li>
              {% if object.estado_aprobacion.paso > 3 %}
                <li class="nav-item"><a class="nav-link" href="#fideicomiso" data-toggle="tab">Fideicomiso</a></li>
              {% endif %}
              {% if object.estado_aprobacion.paso >= 6 %}
                <li class="nav-item"><a class="nav-link" href="#minuta_escrituracion" data-toggle="tab">Minuta Escrituración</a></li>
              {% endif %}
              {% if object.estado_aprobacion.paso >= 9 %}
                <li class="nav-item"><a class="nav-link" href="#nueva_documentacion" data-toggle="tab">Nueva documentación</a></li>
              {% endif %}
              
              {% if object.estado_aprobacion.paso >= 9.4 %}
                <li class="nav-item"><a class="nav-link" href="#kpi" data-toggle="tab">KPI</a></li>
                <li class="nav-item"><a class="nav-link" href="#marketplace" data-toggle="tab">Marketplace</a></li>
              {% endif %}

            </ul>
          </div><!-- /.card-header -->
          <div class="card-body">
            <div class="tab-content">
            
              <div class="row">
                <div class="col-md-12 p-3">
                  {% if object.estado_aprobacion.codigo == 'ACTIVO_SIN_APROBAR_SPONSOR'  %}
                    <button id="btn-aprobar" class="btn btn-info btn-block" type="button" name="button" 
                    data-accion="" data-estado="{{object.estado_aprobacion}}" disabled>
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'PENDIENTE_RESPUESTA_PROPIETARIO'  %}
                    <button id="btn-aprobar" class="btn btn-info btn-block" type="button" name="button" 
                    data-accion="" data-estado="{{object.estado_aprobacion}}" disabled>
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'ACTIVO_APROBADO_SPONSOR'  and perms.asset.approved_activo_devise %}
                    <button id="btn-aprobar" class="btn btn-danger btn-block" type="button" name="button" 
                    data-accion="aprobar_activo_devise" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'PENDIENTE_RESPUESTA_SPONSOR'  %}
                    <button id="btn-aprobar" class="btn btn-warning btn-block" type="button" name="button" 
                    data-accion="" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'ACTIVO_APROBADO_DEVISE' %}
                    {%if perms.asset.approved_activo_fiducia %}
                      <button id="btn-aprobar" class="btn btn-success btn-block" type="button" name="button" 
                      data-accion="aprobar_activo_fiducia" data-estado="{{object.estado_aprobacion}}" >
                        {{ object.estado_aprobacion }}
                      </button>
                    {% else %}
                      <button id="btn-aprobar" class="btn btn-success btn-block" type="button" name="button" disabled
                      data-accion="" data-estado="{{object.estado_aprobacion}}" >
                        {{ object.estado_aprobacion }}
                      </button>
                    {% endif %}
                  {% elif object.estado_aprobacion.codigo == 'ACTIVO_FIDEICOMISO_FIRMADO'  %}
                    <button id="btn-aprobar" class="btn btn-warning btn-block" type="button" name="button" 
                    data-accion="espera_minuta_sponsor" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'NUEVO_CERTIFICADO_TRADICION_Y_LIBERTAD'  %}
                    <button id="btn-aprobar" class="btn btn-warning btn-block" type="button" name="button" 
                    data-accion="validar_encargo_fiduciario" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'PENDIENTE_RESPUESTA_KPI_DEVISE' and request.user|has_group:"ADMINISTRADOR" %}
                    <button id="btn-aprobar" class="btn btn-warning btn-block" type="button" name="button" 
                    data-accion="validar_kpi_devise" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'ACTIVO_KPI_APROBADO_DEVISE' and request.user|has_group:"ADMINISTRADOR" %}
                    <button id="btn-aprobar" class="btn btn-warning btn-block" type="button" name="button" 
                    data-accion="generate_smartcontract" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }} 
                    </button>
                  {% else %}
                      <button id="btn-aprobar" class="btn btn-primary btn-block" type="button" name="button" 
                      data-accion="" data-estado="{{object.estado_aprobacion}}" disabled>
                        <b>{{object.estado_aprobacion}} </b>
                      </button>
                  {% endif %}
                </div>
              </div>
              {% comment %} Pestaña General {% endcomment %}
              <div class="active tab-pane" id="general">
                <form class="form-horizontal">

                  <div class="row">
                    <input id="object_id" type="hidden" name="object_id" value="{{ object.pk }}">
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Código</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.codigo }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Propietario</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.propietario.user_get_full_name }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Nombre:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Ciudad:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.ciudad }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Dirección:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.direccion }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Latitud:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.latitud }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Longitud:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.longitud }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Tipo proyecto:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tipo_proyecto.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Dimensión m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.dimension_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área construida m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_construida_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área GLA m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_gla_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área Vendible m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_vendible_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área Lote m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_lote_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Año construcción</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.ano_construccion }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-12">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Descripción Proyecto</label>
                        <div class="col-md-9">
                          <textarea  class="form-control" rows="4" disabled>{{object.descripcion_proyecto}}</textarea>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-12">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Descripción Ubicación</label>
                        <div class="col-md-9">
                          <textarea  class="form-control" rows="4" disabled>{{object.descripcion_ubicacion}}</textarea>
                        </div>
                      </div>
                    </div>

                  </div>
                </form>
              </div>

              {% comment %} Pestaña Documentos {% endcomment %}
              <div class="tab-pane" id="documentos">
                <form class="form-horizontal">
                  
                  <div class="row">
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Valor del Activo</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.valor_activo|stringformat:".1f"|intcomma }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Matricula inmobiliaria</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.matricula_inmobiliaria }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Cédula Catastral</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.cedula_catastral }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Categoría</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.categoria.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Tipo proyecto</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tipo_proyecto.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-4 col-form-label">Certificado tradición y libertad</label>
                        <div class="col-md-8">
                          {% if object.certificado_tradicion_libertad %}
                            <hr><iframe src="{{ object.certificado_tradicion_libertad.url }}"></iframe><hr>

                            <a href="{{ object.certificado_tradicion_libertad.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          {% else %}
                            <span>No se ha cargado ningúna imagen</span>
                          {% endif %}
                          
                        </div>
                      </div>
                    </div>

                  </div>

                  <div class="row">
                    <table class="table">
                          <thead>
                            <tr>
                              <th class="text-center">Imagen</th>
                              <th class="text-center">Archivo</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Imagen 1</td>
                              <td class="text-center">
                                  {% if object.imagen_1 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_1.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview" data-src="{{ object.imagen_1.url }}">Ver</a>
                                    <a href="{{ object.imagen_1.url }}" class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 2</td>
                              <td class="text-center">
                                  {% if object.imagen_2 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_2.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_2.url }}">Ver</a>
                                    <a href="{{ object.imagen_2.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 3</td>
                              <td class="text-center">
                                  {% if object.imagen_3 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_3.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_3.url }}">Ver</a>
                                    <a href="{{ object.imagen_3.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 4</td>
                              <td class="text-center">
                                  {% if object.imagen_4 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_4.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_4.url }}">Ver</a>
                                    <a href="{{ object.imagen_4.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 5</td>
                              <td class="text-center">
                                  {% if object.imagen_5 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_5.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_5.url }}">Ver</a>
                                    <a href="{{ object.imagen_5.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                  </div>

                </form>
              </div>

              {% comment %} Pestaña Arriendo {% endcomment %}
              <div class="tab-pane" id="arriendo">
                <form class="form-horizontal">
                  
                  <div class="row">
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Nombre Arrendatario</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.nombre_arrendatario }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Canon arriendo</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.canon_arriendo|stringformat:".1f"|intcomma }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Información arrendatario</label>
                        <div class="col-md-9">
                          <textarea class="form-control" rows="4" disabled>
                            {{ object.informacion_arrendatario }}
                          </textarea>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Vencimiento contrato arriendo</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.vencimiento_contrato_arrendamiento }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-4 col-form-label">Contrato Arriendo</label>
                        <div class="col-md-8">
                          {% if object.contrato_arriendo %}
                            <hr><iframe src="{{ object.contrato_arriendo.url }}"></iframe><hr>

                            <a href="{{ object.contrato_arriendo.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          {% else %}
                            <span>No se ha cargado ningúna imagen</span>
                          {% endif %}
                          
                        </div>
                      </div>
                    </div>


                  </div>
                </form>
              </div>

              {% comment %} Pestaña fideicomiso {% endcomment %}
              <div class="tab-pane" id="fideicomiso">
                {% if object.estado_aprobacion.paso >= 6 %}

                  <form class="form-horizontal" name="" id="" method="" >
                    <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                      <div class="col-md-12">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Documento Firmado</label>
                          
                          <div class="col-md-9">
                            <hr><iframe src="{{ fideicomiso.fideicomiso_firmado.url }}"></iframe><hr>

                              <a href="{{ fideicomiso.fideicomiso_firmado.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          </div>
                        </div>
                      </div>
                  </form>

                  <div class="card">
                  <!-- /.card-header -->
                  <div class="card-body p-0">
                    <table class="table">
                      <thead>
                        <tr>
                          <th style="width: 10px"> </th>
                          <th>Firmante</th>
                          <th style="width: 40px">Documento</th>
                          <th style="width: 40px">Biometria Facial</th>
                          <th style="width: 40px">Prueba Vida</th>
                          <th style="width: 150px">Información</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            {% if fideicomiso.fiducia_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Gerente Negocio: {{fideicomiso.email_fiducia}} </td>
                          <td>
                            {% if fideicomiso.fiducia_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                            
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.fiducia_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.devise_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Devise: {{fideicomiso.email_devise}} </td>
                          <td>
                            {% if fideicomiso.devise_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.devise_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.sponsor_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Sponsor: {{fideicomiso.email_sponsor}} </td>
                          <td>
                            {% if fideicomiso.sponsor_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.sponsor_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.propietario_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-success"><i class="fas fa-clock"></i>

                            {% endif %}

                          </td>
                          <td>Propietario: {{fideicomiso.email_propietario}} </td>
                          <td>
                            {% if fideicomiso.propietario_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.propietario_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <!-- /.card-body -->
                  </div>  

                {% elif  fideicomiso and fideicomiso.enviado_weetrust %}

                  <form class="form-horizontal" name="" id="" method="" >
                    <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                      <div class="col-md-12">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Documento Fideicomiso</label>
                          
                          <div class="col-md-9">
                            <hr><iframe src="{{ fideicomiso.fideicomiso.url }}"></iframe><hr>

                              <a href="{{ fideicomiso.fideicomiso.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          </div>
                        </div>
                      </div>
                  </form>

                  <div class="card">
                  <!-- /.card-header -->
                  <div class="card-body p-0">
                    <table class="table">
                      <thead>
                        <tr>
                          <th style="width: 10px"> </th>
                          <th>Firmante</th>
                          <th style="width: 40px">Documento...</th>
                          <th style="width: 40px">Biometria Facial</th>
                          <th style="width: 40px">Prueba Vida</th>
                          <th style="width: 150px">Información</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            
                            {% if fideicomiso.fiducia_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-info"><i class="fas fa-clock"></i>
                            {% endif %}
                          </td>
                          <td>Gerente Negocio: {{fideicomiso.email_fiducia}} </td>
                          <td>
                            {% if fideicomiso.fiducia_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.fiducia_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% else %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.fiducia_signing_url }}" target="_blank">
                                      <i class="fas fa-signature nav-icon"> URL de Firma</i> 
                                  </a>
                              </span>
                            {% endif %}
                            {% if fideicomiso.fiducia_json.overall == False %}
                              <span class="badge bg-warning" name='btn-repetir-firma' biometricLogID="{{fideicomiso.fiducia_sesion}}" firmante="Fiducia" data-accion="">
                                  <a href="#"  id="btn-repetir-firma" >
                                      <i class="fas fa-exclamation-triangle"></i> Repetir
                                  </a>
                              </span>
                            {% endif %}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.devise_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-info"><i class="fas fa-clock"></i>
                            {% endif %}
                          </td>
                         
                          <td>Devise: {{fideicomiso.email_devise}} </td>
                          <td>
                            {% if fideicomiso.devise_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.devise_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% else %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.devise_signing_url }}" target="_blank">
                                      <i class="fas fa-signature nav-icon"> URL de Firma</i> 
                                  </a>
                              </span>
                            {% endif %}
                            {% if fideicomiso.devise_json.overall == False %}
                              <span class="badge bg-warning" name='btn-repetir-firma' biometricLogID="{{fideicomiso.devise_sesion}}" firmante="Devise" data-accion="">
                                  <a href="#"  id="btn-repetir-firma"  >
                                      <i class="fas fa-exclamation-triangle"></i> Repetir
                                  </a>
                              </span>
                            {% endif %}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.sponsor_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-info"><i class="fas fa-clock"></i>
                            {% endif %}
                          </td>
                          <td>Sponsor: {{fideicomiso.email_sponsor}} </td>
                          <td>
                            {% if fideicomiso.sponsor_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.sponsor_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% else %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.sponsor_signing_url }}" target="_blank">
                                      <i class="fas fa-signature nav-icon"> URL de Firma</i> 
                                  </a>
                              </span>
                            {% endif %}
                            {% if fideicomiso.sponsor_json.overall == False %}
                              <span class="badge bg-warning" name='btn-repetir-firma' biometricLogID="{{fideicomiso.sponsor_sesion}}" firmante="Sponsor" data-accion="">
                                  <a href="#"  id="btn-repetir-firma"  >
                                      <i class="fas fa-exclamation-triangle"></i> Repetir
                                  </a>
                              </span>
                            {% endif %}
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.propietario_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-info"><i class="fas fa-clock"></i>
                            {% endif %}
                          </td>
                          <td>Propietario: {{fideicomiso.email_propietario}} </td>
                          <td>
                            {% if fideicomiso.propietario_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% else %}
                              <span class="badge bg-warning"><i class="fas fa-exclamation"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_biometric_url  %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.propietario_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% else %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.propietario_signing_url }}" target="_blank">
                                      <i class="fas fa-signature nav-icon"> URL de Firma</i> 
                                  </a>
                              </span>
                            {% endif %}
                            {% if fideicomiso.propietario_json.overall == False %}
                              <span class="badge bg-warning" name='btn-repetir-firma' data-accion=""  biometricLogID="{{fideicomiso.propietario_sesion}}" firmante="Propietario" >
                                  <a href="#"  id="btn-repetir-firma" >
                                      <i class="fas fa-exclamation-triangle"></i> Repetir
                                  </a>
                              </span>
                            {% endif %}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <!-- /.card-body -->
                  </div>
              
                {% elif  fideicomiso %}
                  <form class="form-horizontal" name="signFideicomiso" id="id_signFideicomiso" method="post" >
                    <div class="row">
                      {% csrf_token %}
                      <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                      <div class="col-md-12">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Documento Fideicomiso</label>
                          
                          <div class="col-md-9">
                            <hr><iframe src="{{ fideicomiso.fideicomiso.url }}"></iframe><hr>

                              <a href="{{ fideicomiso.fideicomiso.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Gerente de negocio:</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.name_fiducia  class="form-control" %}
                            {% for error in fideicomiso_form.name_fiducia.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Correo:</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.email_fiducia  class="form-control" %}
                            {% for error in fideicomiso_form.email_fiducia.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12">
                        <hr>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Nombre Devise</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.name_devise  class="form-control" %}
                            {% for error in fideicomiso_form.name_devise.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Correo Devise</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.email_devise  class="form-control" %}
                            {% for error in fideicomiso_form.email_devise.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>


                      <div class="col-md-12">
                        <hr>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Nombre Propietario</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.name_propietario  class="form-control" %}
                            {% for error in fideicomiso_form.name_propietario.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Correo Propietario</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.email_propietario  class="form-control" %}
                            {% for error in fideicomiso_form.email_propietario.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12">
                        <hr>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Nombre Sponsor</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.name_sponsor  class="form-control" %}
                            {% for error in fideicomiso_form.name_sponsor.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Correo Sponsor Proyecto</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_form.email_sponsor  class="form-control" %}
                            {% for error in fideicomiso_form.email_sponsor.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>


                    </div>
                          <button type="button" class="btn btn-primary float-right"  onclick="solicitarFirmas()" name="button">Solicitar firmas</button>

                  </form>
                {% else %}

                  <form class="form-horizontal" id="addFideicomiso" enctype="multipart/form-data">
                    {% csrf_token %}
                      <input id="id_activo_fideicomiso" type="hidden" name="activo" value="{{ object.pk }}">
                    <div class="row">

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label for="" class="col-md-3 col-form-label">Gerente Negocio Fiducia</label>
                          <div class="col-md-9">
                            {% render_field fideicomiso_upload.gerente_negocio  class="form-control" %}
                            {% for error in fideicomiso_upload.gerente_negocio.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12">
                        <div class="form-group row">
                          <label  class="col-md-3 col-form-label">Archivo Fideicomiso</label>
                          <div class="col-md-12">
                            {% render_field fideicomiso_upload.fideicomiso  class="form-control"  %}
                            {% for error in fideicomiso_upload.fideicomiso.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                    </div>
                          <button type="button" class="btn btn-primary float-right"  onclick="subirArchivo()" name="button">Subir Archivo</button>

                  </form>

                {% endif %}
              
              </div>

              {% comment %} Pestaña minuta_escrituracion {% endcomment %}
              <div class="tab-pane" id="minuta_escrituracion">
                {% if minuta %}
                <form class="form-horizontal" name="" id="" method="" >
                  <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                    <div class="col-md-12">
                      <div class="form-group row">
                        <label for="" class="col-md-3 col-form-label">Minuta escrituración</label>
                        
                        <div class="col-md-9">
                          <hr><iframe src="{{ minuta.archivo.url }}"></iframe><hr>

                            <a href="{{ minuta.archivo.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                        </div>
                      </div>
                    </div>
                </form>

                <div class="card">
                <!-- /.card-header -->
                  <div class="card-body p-0">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Equipo</th>
                          <th>Firmante</th>
                          <th style="width: 150px">Aprobado</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            Fiducia
                          </td>
                          <td>
                            {{minuta.activo.gerente_negocio}}
                          </td>
                          <td>
                            {% if minuta.aprobado_fiducia == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% else %}
                              {% if  request.user ==  minuta.activo.gerente_negocio or  request.user.fiducia == minuta.activo.fiducia %}
                                <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                </button>
                               
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                          <td>
                            Sponsor
                          </td>
                          <td>
                            {{minuta.activo.sponsor.user}}
                          </td>
                          <td>
                             {% if minuta.aprobado_sponsor == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% else %}
                              {% if  request.user ==  minuta.sponsor.user  %}
                                <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                </button>
                               
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                          <td>
                            Propietario
                          </td>
                          <td>
                            {{minuta.activo.propietario}}
                          </td>
                          <td>
                            {% if minuta.aprobado_propietario == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% else %}
                              {% if  request.user ==  minuta.activo.propietario  %}
                                <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                </button>
                               
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                          <td>
                            Notaria
                          </td>
                          {% if minuta.activo.notaria %}
                            <td>
                              {{minuta.activo.notaria}}
                            </td>
                            <td>
                              {% if minuta.aprobado_notario == True %}
                                <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            </td>
                          {% else %}
                          <td> Sin asignar
                          </td>
                          <td></td>
                          {% endif %}
                        </tr>
                        
                      </tbody>
                    </table>
                  </div>

                  
                      <!-- /.card-body -->

                </div>  

                {% else %}
                  <h1>Pendiente que el Sponsor envie la minuta</h1>
                {% endif %}

                <!-- DIRECT CHAT -->
                  <div class="card direct-chat direct-chat-primary" >
                    <div class="card-header">
                      <h3 class="card-title">Anotaciones de la Minuta de escrituración</h3>

                      <div class="card-tools">
                        
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                          <i class="fas fa-minus"></i>
                        </button>
                      
                        
                      </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                      <!-- Conversations are loaded here -->
                      <div class="direct-chat-messages" style="height: 300px;">
                        {% for message in minuta_feedback %}
                          {% if message.remitente == request.user  %}
                          <!-- Message to the right  es de Devise ADMIN-->
                            <div class="direct-chat-msg right" >
                              <div class="direct-chat-infos clearfix">
                                <span class="direct-chat-name float-right">{{ message.remitente.email }}</span>
                              </div>
                              <!-- /.direct-chat-infos -->
                              <img class="direct-chat-img" src="{% static 'icons/isotipo_devise.png' %}" alt="admin">
                              <!-- /.direct-chat-img -->
                              <div class="direct-chat-text">
                                {{message.mensaje}}
                              </div>
                              {% if message.archivo_adjunto %}
                                <span class="direct-chat-timestamp float-left">
                                  <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                                  <i class="fas fa-paperclip"></i>
                                    {{ message.filename }}
                                  </a>
                                </span>
                              {% endif %}
                                <span class="direct-chat-timestamp float-right">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                            <!-- /.direct-chat-text -->
                            </div>
                          <!-- /.direct-chat-msg -->
                          
                          {% else %}
                          <!-- Message. Default to the left  es del cliente-->
                            <div class="direct-chat-msg">
                              <div class="direct-chat-infos clearfix">
                                <span class="direct-chat-name float-left">{{ message.remitente.email }}</span>
                              </div>
                              <!-- /.direct-chat-infos -->
                              {% if  message.remitente.selfie %}
                                <img class="direct-chat-img" src="{{ message.remitente.selfie.url }}" alt="usr">
                              {% else %}
                                <img class="direct-chat-img" src="{% static 'icons/user_unknow.png' %}" alt="usr">
                              {% endif %}
                              <!-- /.direct-chat-img -->
                              <div class="direct-chat-text">
                                {{message.mensaje}}
                              </div>
                              {% if message.archivo_adjunto %}
                                <span class="direct-chat-timestamp float-right">
                                  <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                                  <i class="fas fa-paperclip"></i>
                                    {{ message.filename }}
                                  </a>
                                </span>
                              {% endif %}
                                <span class="direct-chat-timestamp float-left">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                              <!-- /.direct-chat-text -->
                            </div>
                          <!-- /.direct-chat-msg -->
                          {% endif %}
                        <hr>
                        {% endfor %}
                      </div>
                      <!--/.direct-chat-messages-->

                      
                    </div>
                    
                  </div>
                  <!--/.direct-chat -->

              </div>

              {% comment %} Pestaña nueva_documentacion {% endcomment %}
              <div class="tab-pane" id="nueva_documentacion">

                {% if object.nueva_escritura %}
                  <div class="card">
                    <!-- /.card-header -->
                    <div class="card-body p-0">
                      <form class="form-horizontal" name="" id="" method="" >
                        <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                          <div class="col-md-12">
                            <div class="form-group row">
                              <label for="" class="col-md-3 col-form-label">Nueva escritura:</label>
                              
                              <div class="col-md-9">
                                <hr><iframe src="{{ object.nueva_escritura.url }}"></iframe><hr>

                                  <a href="{{ object.nueva_escritura.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                              </div>
                            </div>
                          </div>
                      </form>
                    </div>
                  </div> 
                {% else %}
                  <div class="card-body p-0">
                    <h1>Pendiente que el Notario envie la nueva escritura</h1>
                  </div>
                {% endif %}
                <!-- /.card-body -->

                {% if object.certificado_tradicion_libertad %}
                  <div class="card">
                    <!-- /.card-header -->
                    <div class="card-body p-0">
                      <form class="form-horizontal" name="" id="" method="" >
                        <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                          <div class="col-md-12">
                            <div class="form-group row">
                              <label for="" class="col-md-3 col-form-label">Nuevo Certificado tradición y libertad</label>
                              
                              <div class="col-md-9">
                                <hr><iframe src="{{ object.certificado_tradicion_libertad.url }}"></iframe><hr>

                                  <a href="{{ object.certificado_tradicion_libertad.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                              </div>
                            </div>
                          </div>
                      </form>
                    </div>
                  </div> 
                {% else %}
                  <div class="card-body p-0">
                    <h1>Pendiente que el Notario envie la nueva escritura</h1>
                  </div>
                {% endif %}
                <!-- /.card-body -->


              </div>

              {% comment %} Pestaña kpi {% endcomment %}
              <div class="tab-pane" id="kpi">
                <form class="form-horizontal">
                  
                  <div class="row">
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Valor Token (COP)</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.valor_token }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Token totales</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tokens_totales}}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Token Disponibles</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tokens_disponibles}}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">TIR EA</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tir_ea}}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Pago rendimiento</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.pago_rendimiento }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Tenencia sugerida</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tenencia_sugerida }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Renta mensual</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.renta_mensual }} " disabled>
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Renta por m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.renta_por_m2 }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Incremento Anual</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.incremento_anual }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Clase de inversión</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.clase_inversion }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Plazo de Contrato</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.plazo_contrato }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Numero de ID fideicomiso</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.no_id_fideicomiso }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Nombre del Fideicomiso</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.nombre_fideicomiso }} " disabled>
                        </div>
                      </div>
                    </div>

                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-4 col-form-label">Modelo financiero</label>
                        <div class="col-md-8">
                          {% if object.modelo_financiero %}
                            <hr><iframe src="{{ object.modelo_financiero.url }}"></iframe><hr>

                            <a href="{{ object.modelo_financiero.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          {% else %}
                            <span>No se ha cargado ningun documento</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-4 col-form-label">Teaser</label>
                        <div class="col-md-8">
                          {% if object.teaser %}
                            <hr><iframe src="{{ object.teaser.url }}"></iframe><hr>

                            <a href="{{ object.teaser.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          {% else %}
                            <span>No se ha cargado ningun documento</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </div>

                </form>
                <!-- /.card-header -->
                <!-- DIRECT CHAT -->
                  <div class="card direct-chat direct-chat-primary" >
                    <div class="card-header">
                      <h3 class="card-title">Anotaciones KPI activo</h3>

                      <div class="card-tools">
                        
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                          <i class="fas fa-minus"></i>
                        </button>
                      
                        
                      </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                      <!-- Conversations are loaded here -->
                      <div class="direct-chat-messages" style="height: 300px;">
                        {% for message in kpi_feedback %}
                          {% if message.remitente == request.user  %}
                          <!-- Message to the right  es de Devise ADMIN-->
                            <div class="direct-chat-msg right" >
                              <div class="direct-chat-infos clearfix">
                                <span class="direct-chat-name float-right">{{ message.remitente.email }}</span>
                              </div>
                              <!-- /.direct-chat-infos -->
                              <img class="direct-chat-img" src="{% static 'icons/isotipo_devise.png' %}" alt="admin">
                              <!-- /.direct-chat-img -->
                              <div class="direct-chat-text">
                                {{message.mensaje}}
                              </div>
                              {% if message.archivo_adjunto %}
                                <span class="direct-chat-timestamp float-left">
                                  <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                                  <i class="fas fa-paperclip"></i>
                                    {{ message.filename }}
                                  </a>
                                </span>
                              {% endif %}
                                <span class="direct-chat-timestamp float-right">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                            <!-- /.direct-chat-text -->
                            </div>
                          <!-- /.direct-chat-msg -->
                          
                          {% else %}
                          <!-- Message. Default to the left  es del cliente-->
                            <div class="direct-chat-msg">
                              <div class="direct-chat-infos clearfix">
                                <span class="direct-chat-name float-left">{{ message.remitente.email }}</span>
                              </div>
                              <!-- /.direct-chat-infos -->
                              {% if  message.remitente.selfie %}
                                <img class="direct-chat-img" src="{{ message.remitente.selfie.url }}" alt="usr">
                              {% else %}
                                <img class="direct-chat-img" src="{% static 'icons/user_unknow.png' %}" alt="usr">
                              {% endif %}
                              <!-- /.direct-chat-img -->
                              <div class="direct-chat-text">
                                {{message.mensaje}}
                              </div>
                              {% if message.archivo_adjunto %}
                                <span class="direct-chat-timestamp float-right">
                                  <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                                  <i class="fas fa-paperclip"></i>
                                    {{ message.filename }}
                                  </a>
                                </span>
                              {% endif %}
                                <span class="direct-chat-timestamp float-left">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                              <!-- /.direct-chat-text -->
                            </div>
                          <!-- /.direct-chat-msg -->
                          {% endif %}
                        <hr>
                        {% endfor %}
                      </div>
                      <!--/.direct-chat-messages-->

                      
                    </div>
                    
                  </div>
                  <!--/.direct-chat -->
              </div>

              {% comment %} Pestaña marketplace {% endcomment %}
              <div class="tab-pane" id="marketplace">
                <form class="form-horizontal">
                  
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-4 col-form-label">Documento de sesión</label>
                        <div class="col-md-8">
                          {% if object.documento_cesion %}
                            <hr><iframe src="{{ object.documento_cesion.url }}"></iframe><hr>

                            <a href="{{ object.documento_cesion.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          {% else %}
                            <span>No se ha cargado ningun documento</span>
                          {% endif %}
                          
                        </div>
                      </div>
                    </div>
                      


                  </div>
                </form>
              </div>
              {% comment %} <button id="consultarTokenButton">Consultar Información Token</button> {% endcomment %}

              <div id="resultado"></div>

              <a href="{% url 'asset-admin-list' %}" class="btn btn-default">Volver</a>

            </div>
            <!-- /.tab-content -->
          </div><!-- /.card-body -->
        </div>
        <!-- /.nav-tabs-custom -->
      </div>
      <!-- /.col -->
      <div class="col-md-3">
            <!-- DIRECT CHAT -->
            {% if object.estado_aprobacion.paso < 5 %}
            <div class="card direct-chat direct-chat-primary" >
              <div class="card-header" style="background-color: #f1ea1c;">
                <h3 class="card-title">Observaciones Activo</h3>

                <div class="card-tools">
                  
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                 
                  
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <!-- Conversations are loaded here -->
                <div class="direct-chat-messages" style="height: 400px;">
                  {% for message in chat %}
                    
                    {% if message.remitente == request.user  or message.remitente.role == 'ADMINISTRADOR' %}
                    <!-- Message to the right  es de Devise ADMIN-->
                      <div class="direct-chat-msg right">
                        <div class="direct-chat-infos clearfix">
                          <span class="direct-chat-name float-right">{{ message.remitente.email }}</span>
                        </div>
                        <!-- /.direct-chat-infos -->
                        <img class="direct-chat-img" src="{% static 'icons/isotipo_devise.png' %}" alt="admin">
                        <!-- /.direct-chat-img -->
                        <div class="direct-chat-text">
                          {{message.mensaje}}
                        </div>
                        {% if message.archivo_adjunto %}
                          <span class="direct-chat-timestamp float-left">
                            <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                            <i class="fas fa-paperclip"></i>
                              {{ message.filename }}
                            </a>
                          </span>
                        {% endif %}
                          <span class="direct-chat-timestamp float-right">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                      <!-- /.direct-chat-text -->
                      </div>
                    <!-- /.direct-chat-msg -->
                    
                    {% else %}
                    <!-- Message. Default to the left  es del cliente-->
                      <div class="direct-chat-msg">
                        <div class="direct-chat-infos clearfix">
                          <span class="direct-chat-name float-left">{{ message.remitente.email }}</span>
                        </div>
                        <!-- /.direct-chat-infos -->
                        {% if  message.remitente.selfie %}
                          <img class="direct-chat-img" src="{{ message.remitente.selfie.url }}" alt="usr">
                        {% else %}
                          <img class="direct-chat-img" src="{% static 'icons/user_unknow.png' %}" alt="usr">
                        {% endif %}
                        <!-- /.direct-chat-img -->
                        <div class="direct-chat-text">
                          {{message.mensaje}}
                        </div>
                        {% if message.archivo_adjunto %}
                          <span class="direct-chat-timestamp float-right">
                            <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                            <i class="fas fa-paperclip"></i>
                              {{ message.filename }}
                            </a>
                          </span>
                        {% endif %}
                          <span class="direct-chat-timestamp float-left">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                        <!-- /.direct-chat-text -->
                      </div>
                    <!-- /.direct-chat-msg -->
                    {% endif %}
                  <hr>
                  {% endfor %}
                </div>
                <!--/.direct-chat-messages-->

                
              </div>
              <!-- /.card-body -->
              {% comment %} <div class="card-footer">
                <form action="#" method="post">
                  <div class="input-group">
                    <input type="text" name="message" placeholder="Type Message ..." class="form-control">
                    <span class="input-group-append">
                      <button type="button" class="btn btn-primary">Send</button>
                    </span>
                  </div>
                </form>
              </div> {% endcomment %}
              <!-- /.card-footer-->
            </div>
            <!--/.direct-chat -->
            {% endif %}
            <!-- Asset Image -->
            <div class="card card-indigo">
              <div class="card-header">
                <h3 class="card-title">Sponsor</h3>
              </div>
              {% if object.sponsor %}
                <div class="card-body box-profile">
                  <div class="text-center">
                    <img class="profile-user-img img-fluid "
                        src="{{ object.sponsor.logo_empresa.url }}"
                        alt="User profile picture">
                  </div>

                  <h3 class="profile-username text-center">{{ object.sponsor.nombre }}</h3>

                  <p class="text-muted text-center">NIT: {{ object.sponsor.nit}}</p>

                  <ul class="list-group list-group-unbordered mb-3">
                    <li class="list-group-item">
                      <b>Activos administrados</b> <a class="float-right">{{ object.sponsor.get_activos_administrados }}</a>
                    </li>
                    <li class="list-group-item">
                      <b>Clientes</b> <a class="float-right"> {{ object.sponsor.get_clientes }} </a>
                    </li>
                    <li class="list-group-item">
                      <b>Inversión</b> <a class="float-right"> $ {{ object.sponsor.get_total_inversiones|stringformat:".2f"|intcomma }}</a>
                    </li>
                  </ul>
                  <a href="{% url 'company-detail'  object.sponsor.pk %}" class="btn btn-primary btn-block"><b>Ver Sponsor</b></a>
                </div>
              {% else %}
                <div class="card-body box-profile">
                  <div class="text-center">
                    <img class="profile-user-img img-fluid "
                        src="{% static 'icons/no_sponsor.png' %}"
                        alt="User profile picture">
                  </div>

                  <h3 class="profile-username text-center">Sin Asignar</h3>

                  <p class="text-muted text-center"></p>

                  <ul class="list-group list-group-unbordered mb-3">
                    <li class="list-group-item">
                      <b>-</b> <a class="float-right"></a>
                    </li>
                    <li class="list-group-item">
                      <b>-</b> <a class="float-right"></a>
                    </li>
                    <li class="list-group-item">
                      <b>-</b> <a class="float-right"></a>
                  </ul>
                </div>
              {% endif %}
              <!-- /.card-body -->
            </div>
            <!-- /.Asset Image -->
            
          <!-- /.card -->
      </div>
      <!-- /.col -->
      
    </div>
  </div><!-- /.container-fluid -->
</section>
<!-- /.content -->

<div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" data-dismiss="modal">
    <div class="modal-content"  >
      <div class="modal-body">
      	<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <img src="" class="imagepreview" style="width: 100%;" >
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'adminlte-3.1.0/plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/sweetalert2/sweetalert2.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/toastr/toastr.min.js' %}"></script>

<script type="text/javascript">
  const estado_aprobacion_paso = parseFloat({{object.estado_aprobacion.paso}});
  var fideicomiso = "{{fideicomiso}}";
  const enviado = "{{fideicomiso.enviado_weetrust }}";

  // Set Pestaña Evolucion del Activo

  if ( estado_aprobacion_paso  > 4  &&  estado_aprobacion_paso < 6) {
    const enlaceFideicomiso = document.querySelector('a.nav-link[href="#fideicomiso"]');
    if (enlaceFideicomiso) {
        enlaceFideicomiso.click();
    }
  }  else if( estado_aprobacion_paso  >= 6 && estado_aprobacion_paso < 9) {
    console.log("paso 6 a cargar minuta"); 
    const enlaceMinuta = document.querySelector('a.nav-link[href="#minuta_escrituracion"]');
    if (enlaceMinuta) {
        enlaceMinuta.click();
    }
  } else if( estado_aprobacion_paso  >= 9 && estado_aprobacion_paso < 10) {
    console.log("paso 9 nueva documentacion"); 
    const nuevaDocumentacion = document.querySelector('a.nav-link[href="#nueva_documentacion"]');
    if (nuevaDocumentacion) {
        nuevaDocumentacion.click();
    }
  } else if( estado_aprobacion_paso  >= 10 ) {
    console.log("paso 10 Calculos de KPI"); 
    const kpiTab = document.querySelector('a.nav-link[href="#kpi"]');
    if (kpiTab) {
        kpiTab.click();
    }
  }
  else {
    console.log("El valor fue: ", estado_aprobacion_paso)
  }
 // End set pestaña evolucion activo

  

  const activo_id = document.getElementById('object_id');
  const btn_aprobar = document.getElementById('btn-aprobar');
  

  btn_aprobar.addEventListener('mouseenter', (e) => {
		const accion = e.target.getAttribute('data-accion');
    console.log("La accion es ", accion)
		if (accion == 'aprobar_activo_devise') {
			e.target.innerText = 'Revision Devise activo';
		}else if (accion == 'aprobar_activo_sponsor') {
			e.target.innerText = 'Activo aprobado por Devise';
		}else if(accion == 'aprobar_activo_fiducia') {
			e.target.innerText = 'Aprobar activo para constitución Fideicomiso';
		}else if(accion == 'espera_minuta_sponsor') {
			e.target.innerText = 'En espera cargue Minuta escrituracion por Sponsor';
		}else if(accion == 'validar_encargo_fiduciario') {
			e.target.innerText = 'Validar el encargo Fiduciario';
		}else if(accion == 'validar_kpi_devise') {
			e.target.innerText = 'Validar KPI del activo';
		}else if(accion == 'generate_smartcontract') {
			e.target.innerText = 'Generar Smart Contract';
		}
    else {
    }
	});

  btn_aprobar.addEventListener('mouseleave', (e) => {
		const estado = e.target.getAttribute('data-estado');
		e.target.innerText = estado;
	});

  btn_aprobar.addEventListener('click', (e) => {
		const accion = e.target.getAttribute('data-accion');
		accion_activo(accion);
	});

  function accion_activo(accion) {		//OJO ACA SE VALIDA O NO EL ACTIVO
		if (accion == 'aprobar_activo_devise') {
			const id_activo = activo_id.value;
			console.log('aprobar_activo_devise accion: ', id_activo);

			const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

      swalWithBootstrapButtons.fire({
        title: '¿Desea pasar a aprobado el activo?',
        text: "Si no hay observaciones para el Sponsor puede aprobar el activo de lo contrario de click en enviar observación",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Si, aprobar Activo!',
        cancelButtonText: 'Envio observación!',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          //
              let url = Urls.admin_asset_approved();  // URL to send message
              let form_data = new FormData();

              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        data.title,
                        data.message,
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
              //
          
        } else if (
          result.dismiss === Swal.DismissReason.cancel
        ){
         //
          Swal.fire({
          title: 'Mensaje al Sponsor',
          input: 'text',
          inputLabel: 'Digite la información relevante al respecto',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'Enviar',
          showLoaderOnConfirm: true,
          preConfirm: (text) => {
            if (text) {
              console.log('Captured Text:', text);
              //
              let url = Urls.send_admin_asset_message();  // URL to send message
              let form_data = new FormData();

              form_data.append("mensaje", text);
              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        'Mensaje enviado!',
                        'Se ha enviado la novedad al sponsor.',
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
              //

            } else {
              Swal.showValidationMessage('Por favor digite sus observaciones');
            }
          },
          allowOutsideClick: () => !Swal.isLoading()
        })
         //
      
        }
      })
		}
    else if (accion == 'aprobar_activo_fiducia') {
			const id_activo = activo_id.value;
			console.log('aprobar_activo_fiducia accion: ', id_activo);

			const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

      swalWithBootstrapButtons.fire({
        title: 'Fiducia: ¿Desea pasar a aprobado el activo?',
        text: "Si la informacion es correcta puede aprobar el activo y cargar el fideicomiso, de lo contrario de click en cancelar",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Si, aprobar Activo!',
        cancelButtonText: 'No, continuo revisando!',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          //
              let url = Urls.fiducia_asset_approved();  // URL to send message
              let form_data = new FormData();

              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        data.title,
                        data.message,
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
          //
          
        }
      })
		}
    else if (accion == 'validar_encargo_fiduciario') {
			const id_activo = activo_id.value;
			console.log('validar_encargo_fiduciario accion: ', id_activo);

			const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

      swalWithBootstrapButtons.fire({
        title: 'Fiducia: ¿Desea validar el encargo fiduciario?',
        text: "Al validar el encargo fiduciaro quedara a cargo del Sponsor la validación de los KPI",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Si, validar Fideicomiso Activo!',
        cancelButtonText: 'No, continuo revisando!',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          //
              let url = Urls.fiducia_encargofiduciario_approved();  // URL to send message
              let form_data = new FormData();

              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        data.title,
                        data.message,
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
          //
          
        }
      })
		}
    else if (accion == 'validar_kpi_devise') {
			const id_activo = activo_id.value;
			console.log('validar_kpi_devise accion: ', id_activo);

			const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

      swalWithBootstrapButtons.fire({
        title: '¿Desea aprobar los KPI del activo?',
        text: "Si no hay observaciones para el Sponsor puede aprobar los KPI del activo de lo contrario de click en enviar observación",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Si, aprobar Activo!',
        cancelButtonText: 'Envio observación!',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          //
              let url = Urls.admin_approved_kpi();  // URL to send message
              let form_data = new FormData();

              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        data.title,
                        data.message,
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
              //
          
        } else if (
          result.dismiss === Swal.DismissReason.cancel
        ){
         //
          Swal.fire({
          title: 'Mensaje al Sponsor',
          input: 'text',
          inputLabel: 'Digite la información del Kpi que debe corregir',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'Enviar',
          showLoaderOnConfirm: true,
          preConfirm: (text) => {
            if (text) {
              console.log('Captured Text:', text);
              //
              let url = Urls.send_admin_kpi_message();  // URL to send message
              let form_data = new FormData();

              form_data.append("mensaje", text);
              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        'Mensaje enviado!',
                        'Se ha enviado la novedad al sponsor.',
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
              //

            } else {
              Swal.showValidationMessage('Por favor digite sus observaciones');
            }
          },
          allowOutsideClick: () => !Swal.isLoading()
        })
         //
      
        }
      })
		}
    else if (accion == 'generate_smartcontract') {
			const id_activo = activo_id.value;
			console.log('generate_smartcontract accion: ', id_activo);

			const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

      swalWithBootstrapButtons.fire({
        title: '¿Desea generar el SmartContract para el Activo?',
        text: "Si esta preparado para generar la peticion a la blockchain proceda.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Si!',
        cancelButtonText: 'No!',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          // Mostrar el spinner de SweetAlert 2
            Swal.fire({
                title: 'Please Wait !',
                html: 'data uploading',// add html attribute if you want or remove
                allowOutsideClick: false,
                didOpen: () => {
                  Swal.showLoading();
                }
            });

            let url = Urls.create_smart_contract();  // URL to send message
            let form_data = new FormData();

            form_data.append("activo", {{ object.id }});
            form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
            
            fetch(url, {
              method: 'post',
              body: form_data
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              console.log("vienen datos de actualizacion ", data)
              if (data.status == 'success') {
                swal.close();
                Swal.fire(
                    data.title,
                      data.message,
                      'success'
                ).then(() =>{
                  location.reload();
                });
              
              }else{
                Swal.fire(
                      'Error en red!',
                      'por favor recargue la pagina e intente de nuevo.',
                      'warning'
                    )
              }

            })
            .catch(error => {
              Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
            });
            //

        } else {
              Swal.showValidationMessage('Por favor digite sus observaciones');
            }
        
          allowOutsideClick: () => !Swal.isLoading()
        })
         //
      
		}

  }

  $("input[data-bootstrap-switch]").each(function(){
    $(this).bootstrapSwitch('state', $(this).prop('checked'));
  });

  $('.btn-preview').on('click', function() {
		$('.imagepreview').attr('src', $(this).attr('data-src'));
		$('#imagemodal').modal('show');
	});

  function subirArchivo() {
    const formulario = document.querySelector('#addFideicomiso');
    const archivo = formulario.querySelector('input[type="file"]').files[0];
    const id_activo = document.getElementById('id_activo_fideicomiso').value
    const id_gerente_negocio = document.getElementById('id_gerente_negocio').value

    // Validar que los campos no estén vacíos
    if (!id_activo || !id_gerente_negocio || !archivo)
    {   
      Swal.fire({
        title: 'Los campos no deben estar vacios',
        text: 'Asegurese adjuntar el archivo y seleccionar un gerente negocio',
        icon: 'error',
        showConfirmButton: false,
      });
    } else {  
      const formData = new FormData();

      formData.append('id_activo', id_activo);
      formData.append('id_gerente_negocio', id_gerente_negocio);
      formData.append('fideicomiso', archivo);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
      let url = Urls.fiducia_asset_load_fideicomiso();  // URL to send file

      fetch(url, {
          method: 'POST',
          body: formData,
          
      })
      .then(response => response.json())
      .then(data => {
          console.log("vienen datos de actualizacion ", data)
            if (data.status == 'success') {
              Swal.fire(
                    data.title,
                    data.message,
                    'success'
              ).then(() =>{
                location.reload();
              });
            
            }else{
              Swal.fire(
                    'Error en red!',
                    'por favor recargue la pagina e intente de nuevo.',
                    'warning'
                  )
            }
      })
      .catch(error => {
          console.error('Error al subir archivo:', error);
      });
      
    }

    
  }

  function solicitarFirmas(){
    console.log("Solicitud de firmas...");
    const formFirmas = document.querySelector('#id_signFideicomiso');
    const id_fideicomiso = document.getElementById('id_fideicomiso').value
    const id_name_fiducia = document.getElementById('id_name_fiducia').value
    const id_email_fiducia = document.getElementById('id_email_fiducia').value
    const id_name_devise = document.getElementById('id_name_devise').value
    const id_email_devise = document.getElementById('id_email_devise').value
    const id_name_propietario = document.getElementById('id_name_propietario').value
    const id_email_propietario = document.getElementById('id_email_propietario').value
    const id_name_sponsor = document.getElementById('id_name_sponsor').value
    const id_email_sponsor = document.getElementById('id_email_sponsor').value


    // Validar que los campos no estén vacíos
    if ( !id_name_fiducia|| !id_email_fiducia|| !id_name_devise|| !id_email_devise|| !id_name_propietario|| !id_email_propietario|| !id_name_sponsor|| !id_email_sponsor)
    {   
      Swal.fire({
        title: 'Los campos no deben estar vacios',
        text: 'Asegurese que todos los campos estan llenos',
        icon: 'error',
        showConfirmButton: false,
      });
    } else { 
      Swal.fire({
      title: 'Subiendo documento...',
      html: 'Esperando respuesta del servidor',
      allowOutsideClick: false,
      showConfirmButton: false,

      onBeforeOpen: () => {
          Swal.showLoading();
        },
      });
      const formData = new FormData();
      formData.append('id_fideicomiso', id_fideicomiso);
      formData.append('id_name_fiducia', id_name_fiducia);
      formData.append('id_email_fiducia', id_email_fiducia);
      formData.append('id_name_devise', id_name_devise);
      formData.append('id_email_devise', id_email_devise);
      formData.append('id_name_propietario', id_name_propietario);
      formData.append('id_email_propietario', id_email_propietario);
      formData.append('id_name_sponsor', id_name_sponsor);
      formData.append('id_email_sponsor', id_email_sponsor);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

      const url_firma = Urls.fiducia_send_to_sign_fideicomiso(); // URL to send file

      fetch(url_firma, {
          method: 'POST',
          body: formData,
          
      })
      .then(response => response.json())
      .then(data => {
          console.log("vienen datos de actualizacion ", data)
            if (data.status == 'success') {
              Swal.fire(
                    data.title,
                    data.message,
                    'success'
              ).then(() =>{
                location.reload();
              });
            
            }else{
              Swal.fire(
                    data.title,
                    'por favor recargue la pagina e intente de nuevo.',
                    'warning'
                  )
              console.log("error_request_sign", data.message)
            }
      })
      .catch(error => {
          console.error('Error al subir archivo:', error);
      });
      
    }

    
  }
  
  // Repetir Firmas en el documento
  document.addEventListener('DOMContentLoaded', function() {
    var enlacesRepetir = document.getElementsByName('btn-repetir-firma');
    const id_fideicomiso = document.getElementById('id_fideicomiso').value

    enlacesRepetir.forEach(function(enlaceRepetir) {
        enlaceRepetir.addEventListener('click', function(event) {
            event.preventDefault(); // Evitar el comportamiento predeterminado del enlace (scroll)
            var biometricLogID = enlaceRepetir.getAttribute('biometricLogID');
            var firmante =enlaceRepetir.getAttribute('firmante');
            Swal.fire({
              title: '¿Desea solicitar la firma de nuevo?',
              text: "Desea enviar un nuevo correo a " + firmante +" para que valide su firma en el documento ",
              icon: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Si, Solicitar!',
              cancelButtonText: 'No, cancelar'

            }).then((result) => {
              if (result.isConfirmed) {
                const formData = new FormData();
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                console.log("id_fideicomiso :", id_fideicomiso)
                formData.append('id_fideicomiso', id_fideicomiso);
                console.log("biometricLogID :", biometricLogID)
                formData.append('biometricLogID', biometricLogID);

                const url_retry_sign = Urls.retry_sign_fideicomiso(); // URL to send file

                fetch(url_retry_sign, {
                    method: 'POST',
                    body: formData,
                    
                })
                .then(response => response.json())
                .then(data => {
                    console.log("vienen datos de actualizacion ", data)
                      if (data.status == 'success') {
                        Swal.fire(
                              data.title,
                              data.message,
                              'success'
                        ).then(() =>{
                          location.reload();
                        });
                      
                      }else{
                        Swal.fire(
                              data.title,
                               data.message + ' .Por favor recargue la pagina e intente de nuevo.',
                              'warning'
                            )
                        console.log("error_request_sign", data.message)
                      }
                })
                .catch(error => {
                    console.error('Error al solicitar firma:', error);
                });

              }
            })
        });
    });
  });

  //Aprobar Minuta
  const btn_aprobar_minuta = document.getElementById('btn-aprobar-minuta');
  try{
  btn_aprobar_minuta.addEventListener('click', (e) => {
		aprobar_minuta_fiducia();
	});
  } catch(error) {
    console.log('NA minuta ya aprobada:');
  }

  function aprobar_minuta_fiducia() {		//OJO ACA SE VALIDA La minuta de escrituración
    let activo_pk = activo_id.value
    console.log("Validando Minuta de escrituración activo pk: ", activo_pk)
    const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

    swalWithBootstrapButtons.fire({
    title: '¿Desea pasar a aprobado la minuta de escrituración?',
    text: "Si la informacion es correcta puede pasar a aprobar la minuta",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Si, aprobar!',
    cancelButtonText: 'No, envio observación!',
    reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        //
            let url = Urls.minuta_approved_fiducia();  // URL to send message
            let form_data = new FormData();

            form_data.append("activo", {{ object.id }});
            form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
            
            fetch(url, {
              method: 'post',
              body: form_data
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              console.log("vienen datos de actualizacion ", data)
              if (data.status == 'success') {
                Swal.fire(
                      data.title,
                      data.message,
                      'success'
                ).then(() =>{
                  location.reload();
                });
              
              }else{
                Swal.fire(
                      'Error en red!',
                      'por favor recargue la pagina e intente de nuevo.',
                      'warning'
                    )
              }

            })
            .catch(error => {
              Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
            });
            //
        
      } else if (
        result.dismiss === Swal.DismissReason.cancel
      ){
        //
        Swal.fire({
        title: 'Mensaje al Sponsor',
        input: 'text',
        inputLabel: 'Digite la información para la Minuta',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        confirmButtonText: 'Enviar',
        showLoaderOnConfirm: true,
        preConfirm: (text) => {
          if (text) {
            console.log('Captured Text:', text);
            //
            let url = Urls.minuta_new_message();  // URL to send message
            let form_data = new FormData();

            form_data.append("mensaje", text);
            form_data.append("activo", {{ object.id }});
            form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
            
            fetch(url, {
              method: 'post',
              body: form_data
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              console.log("vienen datos de actualizacion ", data)
              if (data.status == 'success') {
                Swal.fire(
                      'Mensaje enviado!',
                      'Se ha enviado la novedad al sponsor.',
                      'success'
                ).then(() =>{
                  location.reload();
                });
              
              }else{
                Swal.fire(
                      'Error en red!',
                      'por favor recargue la pagina e intente de nuevo.',
                      'warning'
                    )
              }

            })
            .catch(error => {
              Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
            });
            //

          } else {
            Swal.showValidationMessage('Por favor digite sus observaciones');
          }
        },
        allowOutsideClick: () => !Swal.isLoading()
      })
        //
    
      }
    })
		
  }

  // Validar los token en kaleido
  document.getElementById("consultarTokenButton").addEventListener("click", function() {
      // Realiza una solicitud AJAX para obtener la información del endpoint
      console.log("consultando tokens");
      // Cambia 'url_del_endpoint' a la URL de tu endpoint
      let url = Urls.read_token_smartcontract();  // URL to send file
      let form_data = new FormData();

      form_data.append("activo", {{ object.id }});
      form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');

        fetch(url, {
          method: 'POST',
          body: form_data,
          })
            .then(response => response.json())
            .then(data => {
                // Manipula los datos obtenidos y muéstralos en el div "resultado"
                document.getElementById("resultado").innerText = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                console.error("Error al consultar el endpoint:", error);
            });
    });

  // Tokenizar el Activo

</script>
{% endblock %}
