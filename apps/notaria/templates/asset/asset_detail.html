{% extends 'adminlte/base/base.html' %}
{% load static i18n %}
{% load humanize %}
{% load widget_tweaks %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/sweetalert2/sweetalert2.min.css' %}">
<link rel="stylesheet" href="{% static 'adminlte-3.1.0/plugins/toastr/toastr.min.css' %}">
<style media="screen">
  .img-150 {
    width: 150px;
    height: 150px;
    max-width: 150px;
    max-height: 150px;
    border: 1px solid #80b229;
    border-radius: 5px;
  }
  .img-200 {
    width: 200px;
    height: 200px;
    max-width: 200px;
    max-height: 200px;
    border: 1px solid #80b229;
    border-radius: 5px;
  }
</style>
{% endblock %}

{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0 text-dark">Detalle Activo: {{ object.codigo }}</h1>
      </div><!-- /.col -->
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="{% url 'devise-dashboard1' %}">Inicio</a></li>
          <li class="breadcrumb-item"><a href="{% url 'asset-admin-list' %}">Activo</a></li>
          <li class="breadcrumb-item active">{{ object.codigo }}</li>
        </ol>
      </div><!-- /.col -->
    </div><!-- /.row -->
  </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header p-2">
            <ul class="nav nav-pills">
              <li class="nav-item"><a class="nav-link active" href="#general" data-toggle="tab">General</a></li>
              <li class="nav-item"><a class="nav-link" href="#documentos" data-toggle="tab">Documental</a></li>
              {% if object.estado_aprobacion.paso > 3 %}
                <li class="nav-item"><a class="nav-link" href="#fideicomiso" data-toggle="tab">Fideicomiso</a></li>
              {% endif %}
              {% if object.estado_aprobacion.paso >= 6 %}
                <li class="nav-item"><a class="nav-link" href="#minuta_escrituracion" data-toggle="tab">Minuta Escrituración</a></li>
              {% endif %}
              {% if object.estado_aprobacion.paso >= 8 %}
                <li class="nav-item"><a class="nav-link" href="#nueva_documentacion" data-toggle="tab">Nueva Documentación</a></li>
              {% endif %}
              
            </ul>
          </div><!-- /.card-header -->
          <div class="card-body">
            <div class="tab-content">
            
              <div class="row">
              {{object.estado_aprobacion}} {{ object.estado_aprobacion.paso }}
                <div class="col-md-12 p-3">
                  {% if object.estado_aprobacion.codigo == 'MINUTA_ESCRITURACION_APROBADA'  %}
                    <button id="btn-aprobar" class="btn btn-info btn-block" type="button" name="button" 
                    data-accion="tramitar_nueva_escritura" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% elif object.estado_aprobacion.codigo == 'EN_REVISION_POR_NOTARIA'  %}
                    <button id="btn-aprobar" class="btn btn-info btn-block" type="button" name="button" 
                    data-accion="cargar_nueva_escritura" data-estado="{{object.estado_aprobacion}}" >
                      {{ object.estado_aprobacion }}
                    </button>
                  {% else %}
                      <button id="btn-aprobar" class="btn btn-primary btn-block" type="button" name="button" 
                      data-accion="" data-estado="{{object.estado_aprobacion}}" disabled>
                        <b>{{object.estado_aprobacion}} </b>
                      </button>
                 {% endif %} 
                </div>
              </div>
              {% comment %} Pestaña General {% endcomment %}
              <div class="active tab-pane" id="general">
                <form class="form-horizontal">

                  <div class="row">
                    <input id="object_id" type="hidden" name="object_id" value="{{ object.pk }}">
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Código</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.codigo }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Propietario</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.propietario.user_get_full_name }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Nombre:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Ciudad:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.ciudad }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Dirección:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.direccion }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Latitud:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.latitud }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Longitud:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.longitud }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Tipo proyecto:</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tipo_proyecto.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Dimensión m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.dimension_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área construida m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_construida_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área GLA m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_gla_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área Vendible m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_vendible_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Área Lote m²</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.area_lote_m2 }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Año construcción</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.ano_construccion }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-12">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Descripción Proyecto</label>
                        <div class="col-md-9">
                          <textarea  class="form-control" rows="4" disabled>{{object.descripcion_proyecto}}</textarea>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-12">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Descripción Ubicación</label>
                        <div class="col-md-9">
                          <textarea  class="form-control" rows="4" disabled>{{object.descripcion_ubicacion}}</textarea>
                        </div>
                      </div>
                    </div>

                  </div>
                </form>
              </div>

              {% comment %} Pestaña Documentos {% endcomment %}
              <div class="tab-pane" id="documentos">
                <form class="form-horizontal">
                  
                  <div class="row">
                    
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Valor del Activo</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.valor_activo|stringformat:".1f"|intcomma }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Matricula inmobiliaria</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.matricula_inmobiliaria }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Cédula Catastral</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.cedula_catastral }} " disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Categoría</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.categoria.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-3 col-form-label">Tipo proyecto</label>
                        <div class="col-md-9">
                          <input type="text" class="form-control" value="{{ object.tipo_proyecto.nombre }}" disabled>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group row">
                        <label  class="col-md-4 col-form-label">Certificado tradición y libertad</label>
                        <div class="col-md-8">
                          {% if object.certificado_tradicion_libertad %}
                            <hr><iframe src="{{ object.certificado_tradicion_libertad.url }}"></iframe><hr>

                            <a href="{{ object.certificado_tradicion_libertad.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                          {% else %}
                            <span>No se ha cargado ningúna imagen</span>
                          {% endif %}
                          
                        </div>
                      </div>
                    </div>

                  </div>

                  <div class="row">
                    <table class="table">
                          <thead>
                            <tr>
                              <th class="text-center">Imagen</th>
                              <th class="text-center">Archivo</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Imagen 1</td>
                              <td class="text-center">
                                  {% if object.imagen_1 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_1.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview" data-src="{{ object.imagen_1.url }}">Ver</a>
                                    <a href="{{ object.imagen_1.url }}" class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 2</td>
                              <td class="text-center">
                                  {% if object.imagen_2 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_2.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_2.url }}">Ver</a>
                                    <a href="{{ object.imagen_2.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 3</td>
                              <td class="text-center">
                                  {% if object.imagen_3 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_3.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_3.url }}">Ver</a>
                                    <a href="{{ object.imagen_3.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 4</td>
                              <td class="text-center">
                                  {% if object.imagen_4 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_4.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_4.url }}">Ver</a>
                                    <a href="{{ object.imagen_4.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                            <tr>
                              <td>Imagen 5</td>
                              <td class="text-center">
                                  {% if object.imagen_5 %}
                                    <p>
                                      <img class="img-fluid img-150" src="{{ object.imagen_5.url }}" alt="Front">
                                    </p>
                                    <a href="javascript:;" class="btn btn-sm btn-primary btn-preview"  data-src="{{ object.imagen_5.url }}">Ver</a>
                                    <a href="{{ object.imagen_5.url }}" class="btn btn-sm btn-secondary" target="_blank">Descargar</a>
                                  {% else %}
                                    <span>No se ha cargado ningúna imagen</span>
                                  {% endif %}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                  </div>

                </form>
              </div>

              {% comment %} Pestaña fideicomiso {% endcomment %}
              <div class="tab-pane" id="fideicomiso">

                <form class="form-horizontal" name="" id="" method="" >
                  <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                    <div class="col-md-12">
                      <div class="form-group row">
                        <label class="col-md-3 col-form-label">Documento Firmado</label>
                        
                        <div class="col-md-9">
                          <hr><iframe src="{{ fideicomiso.fideicomiso_firmado.url }}"></iframe><hr>

                            <a href="{{ fideicomiso.fideicomiso_firmado.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                        </div>
                      </div>
                    </div>
                </form>

                <div class="card">
                <!-- /.card-header -->
                  <div class="card-body p-0">
                    <table class="table">
                      <thead>
                        <tr>
                          <th style="width: 10px"> </th>
                          <th>Firmante</th>
                          <th style="width: 40px">Documento</th>
                          <th style="width: 40px">Biometria Facial</th>
                          <th style="width: 40px">Prueba Vida</th>
                          <th style="width: 150px">Información</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            {% if fideicomiso.fiducia_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Gerente Negocio: {{fideicomiso.email_fiducia}} </td>
                          <td>
                            {% if fideicomiso.fiducia_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.fiducia_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.fiducia_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.fiducia_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.devise_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Devise: {{fideicomiso.email_devise}} </td>
                          <td>
                            {% if fideicomiso.devise_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.devise_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.devise_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.devise_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.sponsor_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Sponsor: {{fideicomiso.email_sponsor}} </td>
                          <td>
                            {% if fideicomiso.sponsor_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.sponsor_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.sponsor_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.sponsor_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                        <tr>
                          <td>
                            {% if fideicomiso.propietario_json.overall == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.overall == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>Propietario: {{fideicomiso.email_propietario}} </td>
                          <td>
                            {% if fideicomiso.propietario_json.id_validation == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.id_validation == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_json.face_recognition == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.face_recognition == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_json.liveness == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% elif fideicomiso.propietario_json.liveness == False %}
                              <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                          </td>
                          <td>
                            {% if fideicomiso.propietario_biometric_url %}
                              <span class="badge bg-info">
                                  <a href="{{ fideicomiso.propietario_biometric_url }}" target="_blank">
                                      <i class="fas fa-info nav-icon"></i> Ver
                                  </a>
                              </span>
                            {% endif %}
                            
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                <!-- /.card-body -->
                </div>  
              
              
              </div>

              {% comment %} Pestaña minuta_escrituracion {% endcomment %}
              <div class="tab-pane" id="minuta_escrituracion">
                {% if minuta %}
                <form class="form-horizontal" name="" id="" method="" >
                  <input id="id_minuta" type="hidden" name="fideicomiso" value="{{ minuta.pk }}">
                    <div class="col-md-12">
                      <div class="form-group row">
                        <label class="col-md-3 col-form-label">Minuta escrituración</label>
                        
                        <div class="col-md-9">
                          <hr><iframe src="{{ minuta.archivo.url }}"></iframe><hr>

                            <a href="{{ minuta.archivo.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                        </div>
                      </div>
                    </div>
                </form>

                <div class="card">
                <!-- /.card-header -->
                  <div class="card-body p-0">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Equipo</th>
                          <th>Firmante</th>
                          <th style="width: 250px">Aprobado</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            Fiducia
                          </td>
                          <td>
                            {{minuta.activo.gerente_negocio}}
                          </td>
                          <td>
                            {% if minuta.aprobado_fiducia == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% else %}
                              {% if  request.user ==  minuta.activo.gerente_negocio or  request.user.fiducia == minuta.activo.fiducia %}
                                <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                </button>
                               
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                          <td>
                            Sponsor
                          </td>
                          <td>
                            {{minuta.activo.sponsor.user}}
                          </td>
                          <td>
                             {% if minuta.aprobado_sponsor == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% else %}
                              {% if  request.user ==  minuta.sponsor.user  %}
                                <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                </button>
                               
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                          <td>
                            Propietario
                          </td>
                          <td>
                            {{minuta.activo.propietario}}
                          </td>
                          <td>
                            {% if minuta.aprobado_propietario == True %}
                              <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                            {% else %}
                              {% if  request.user ==  minuta.activo.propietario  %}
                                <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                </button>
                               
                              {% else %}
                                <span class="badge bg-danger"><i class="fas fa-user-clock"></i>
                              {% endif %}
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                        
                          <td>
                            Notaria
                          </td>
                          {% if minuta.activo.notaria %}
                            <td>
                              {{minuta.activo.notaria}}
                            </td>
                            <td>
                              {% if minuta.aprobado_notaria == True %}
                                <span class="badge bg-success"><i class="fas fa-check nav-icon"></i>
                              {% else %}
                                {% if  request.user.notaria ==  minuta.activo.notaria and minuta.aprobado_notario %}
                                  <button id="btn-aprobar-minuta" class="btn btn-success btn-block btn-sm" name="button-aprobar-minuta" disabled>
                                    <i class="fas fa-check"> Aprobado </i>
                                  </button>
                                {% else %}
                                  <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                  <i class="fas fa-exclamation-triangle"> Actualizar </i>
                                  </button>
                                {% endif %}
                              {% endif %}
                            </td>
                          {% else %}
                              <td>
                                Revisar Activo
                              </td>
                              <td>
                                  <button id="btn-aprobar-minuta" class="btn btn-warning btn-block btn-sm" name="button-aprobar-minuta" >
                                    <i class="fas fa-exclamation-triangle"> Revisar Minuta </i>
                                  </button>
                              </td>
                          {% endif %}
                        </tr>
                        
                      </tbody>
                    </table>
                  </div>

                  
                      <!-- /.card-body -->

                </div>  

                {% else %}
                  <h3>Pendiente que el Sponsor envie la minuta</h3>
                {% endif %}

                <!-- DIRECT CHAT -->
                  <div class="card direct-chat direct-chat-primary" >
                    <div class="card-header">
                      <h3 class="card-title">Anotaciones de la Minuta de escrituración</h3>

                      <div class="card-tools">
                        
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                          <i class="fas fa-minus"></i>
                        </button>
                      
                        
                      </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                      <!-- Conversations are loaded here -->
                      <div class="direct-chat-messages" style="height: 300px;">
                        {% for message in minuta_feedback %}
                          {% if message.remitente == request.user  %}
                          <!-- Message to the right  es de Devise ADMIN-->
                            <div class="direct-chat-msg right" >
                              <div class="direct-chat-infos clearfix">
                                <span class="direct-chat-name float-right">{{ message.remitente.email }}</span>
                              </div>
                              <!-- /.direct-chat-infos -->
                              <img class="direct-chat-img" src="{% static 'icons/isotipo_devise.png' %}" alt="admin">
                              <!-- /.direct-chat-img -->
                              <div class="direct-chat-text">
                                {{message.mensaje}}
                              </div>
                              {% if message.archivo_adjunto %}
                                <span class="direct-chat-timestamp float-left">
                                  <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                                  <i class="fas fa-paperclip"></i>
                                    {{ message.filename }}
                                  </a>
                                </span>
                              {% endif %}
                                <span class="direct-chat-timestamp float-right">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                            <!-- /.direct-chat-text -->
                            </div>
                          <!-- /.direct-chat-msg -->
                          
                          {% else %}
                          <!-- Message. Default to the left  es del cliente-->
                            <div class="direct-chat-msg">
                              <div class="direct-chat-infos clearfix">
                                <span class="direct-chat-name float-left">{{ message.remitente.email }}</span>
                              </div>
                              <!-- /.direct-chat-infos -->
                              {% if  message.remitente.selfie %}
                                <img class="direct-chat-img" src="{{ message.remitente.selfie.url }}" alt="usr">
                              {% else %}
                                <img class="direct-chat-img" src="{% static 'icons/user_unknow.png' %}" alt="usr">
                              {% endif %}
                              <!-- /.direct-chat-img -->
                              <div class="direct-chat-text">
                                {{message.mensaje}}
                              </div>
                              {% if message.archivo_adjunto %}
                                <span class="direct-chat-timestamp float-right">
                                  <a href="{{ message.archivo_adjunto.url }}" class="nav-link" target="_blank">
                                  <i class="fas fa-paperclip"></i>
                                    {{ message.filename }}
                                  </a>
                                </span>
                              {% endif %}
                                <span class="direct-chat-timestamp float-left">{{ message.created_at|date:"d M" }} {{ message.created_at|time:"g:i a" }}</span>
                              <!-- /.direct-chat-text -->
                            </div>
                          <!-- /.direct-chat-msg -->
                          {% endif %}
                        <hr>
                        {% endfor %}
                      </div>
                      <!--/.direct-chat-messages-->

                      
                    </div>
                    
                  </div>
                  <!--/.direct-chat -->

              </div>

              {% comment %} Pestaña nueva_documentacion {% endcomment %}
              <div class="tab-pane" id="nueva_documentacion">

                {% if object.nueva_escritura %}
                  <div class="card">
                    <!-- /.card-header -->
                    <div class="card-body p-0">
                      <form class="form-horizontal" name="" id="" method="" >
                        <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                          <div class="col-md-12">
                            <div class="form-group row">
                              <label for="" class="col-md-3 col-form-label">Nueva escritura:</label>
                              
                              <div class="col-md-9">
                                <hr><iframe src="{{ object.nueva_escritura.url }}"></iframe><hr>

                                  <a href="{{ object.nueva_escritura.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                              </div>
                            </div>
                          </div>
                      </form>
                    </div>
                  </div> 
                {% else %}
                  <div class="card-body p-0">
                    <h3>Señor notario por favor cargue acá la nueva escritura</h3>
                    <form class="form-horizontal" id="addNuevaEscritura" enctype="multipart/form-data">
                    {% csrf_token %}
                      <input id="id_activo" type="hidden" name="activo" value="{{ object.pk }}">
                    <div class="row">

                      <div class="col-md-8">
                        <div class="form-group row">
                          <label  class="col-md-3 col-form-label">Archivo adjunto:</label>
                          <div class="col-md-12">
                            {% render_field form_escritura.nueva_escritura  class="form-control"  %}
                            {% for error in form_escritura.nueva_escritura.errors %}
                              <p class="text-danger">{{ error }}</p>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                    </div>
                          <button type="button" class="btn btn-primary float-right"  onclick="subirArchivo()" name="button">Subir Archivo</button>

                  </form>
                  </div>
                {% endif %}
                <!-- /.card-body -->

                {% if object.nuevo_certificado_tradicion_libertad %}
                  <div class="card">
                    <!-- /.card-header -->
                    <div class="card-body p-0">
                      <form class="form-horizontal" name="" id="" method="" >
                        <input id="id_fideicomiso" type="hidden" name="fideicomiso" value="{{ fideicomiso.pk }}">
                          <div class="col-md-12">
                            <div class="form-group row">
                              <label for="" class="col-md-3 col-form-label">Nuevo Certificado tradición y libertad</label>
                              
                              <div class="col-md-9">
                                <hr><iframe src="{{ object.nuevo_certificado_tradicion_libertad.url }}"></iframe><hr>

                                  <a href="{{ object.nuevo_certificado_tradicion_libertad.url }}"  class="btn btn-sm btn-secondary" target="_blank" >Descargar</a>
                              </div>
                            </div>
                          </div>
                      </form>
                    </div>
                  </div> 
                {% endif %}
                {% if  not object.nuevo_certificado_tradicion_libertad and object.nueva_escritura%}
                    <!-- /.card-header -->
                    <div class="card-body p-0">
                      <div class="alert alert-info alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                        <h5><i class="icon fas fa-info"></i> Pendiente!</h5>
                        Que el Sponsor envie el nuevo certificado de tradición y libertad del inmueble.
                      </div>
                    </div>
                {% endif %}
                <!-- /.card-body -->


              </div>



              <a href="{% url 'asset-notaria-list' %}" class="btn btn-default">Volver</a>

            </div>
            <!-- /.tab-content -->
          </div><!-- /.card-body -->
        </div>
        <!-- /.nav-tabs-custom -->
      </div>
      <!-- /.col -->
      
    </div>
  </div><!-- /.container-fluid -->
</section>
<!-- /.content -->

<div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" data-dismiss="modal">
    <div class="modal-content"  >
      <div class="modal-body">
      	<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <img src="" class="imagepreview" style="width: 100%;" >
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'adminlte-3.1.0/plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/sweetalert2/sweetalert2.min.js' %}"></script>
<script src="{% static 'adminlte-3.1.0/plugins/toastr/toastr.min.js' %}"></script>

<script type="text/javascript">
  const estado_aprobacion_paso = parseFloat({{object.estado_aprobacion.paso}});
  var fideicomiso = "{{fideicomiso}}";
  const enviado = "{{fideicomiso.enviado_weetrust }}";

  // Set Pestaña Evlocuicon Activo

  if ( estado_aprobacion_paso  > 4  &&  estado_aprobacion_paso < 6) {
    const enlaceFideicomiso = document.querySelector('a.nav-link[href="#fideicomiso"]');
    if (enlaceFideicomiso) {
        enlaceFideicomiso.click();
    }
  }  else if( estado_aprobacion_paso  >= 6 && estado_aprobacion_paso < 8) {
    console.log("paso 6 a cargar minuta"); 
    const enlaceMinuta = document.querySelector('a.nav-link[href="#minuta_escrituracion"]');
    // Verifica si se encontró el enlace antes de hacer clic
    if (enlaceMinuta) {
        // Simula un clic en el enlace
        enlaceMinuta.click();
    }
  } else if( estado_aprobacion_paso  >= 8 ) {
    console.log("paso 9 nueva_documentacion "); 
    const enlaceNuevaDocumentacion = document.querySelector('a.nav-link[href="#nueva_documentacion"]');
    // Verifica si se encontró el enlace antes de hacer clic
    if (enlaceNuevaDocumentacion) {
        // Simula un clic en el enlace
        enlaceNuevaDocumentacion.click();
    }
  }
  else {
    console.log("El valor fue: ", estado_aprobacion_paso)
  }
  // End set pestaña evolucion activo
  

  const activo_id = document.getElementById('object_id');
  const btn_aprobar = document.getElementById('btn-aprobar');



  btn_aprobar.addEventListener('mouseenter', (e) => {
		const accion = e.target.getAttribute('data-accion');
    console.log("La accion es ", accion)
		if (accion == 'tramitar_nueva_escritura') {
			e.target.innerText = 'Comenzar tramite notarial';
		}else if (accion == 'nueva_escritura_tramitada') {
			e.target.innerText = 'Finalizar tramiite Notarial';
    }else if (accion == 'cargar_nueva_escritura') {
			e.target.innerText = 'Cargar Nueva Escritura';
    }
    else {
    }
	});

  btn_aprobar.addEventListener('mouseleave', (e) => {
		const estado = e.target.getAttribute('data-estado');
		e.target.innerText = estado;
	});

  btn_aprobar.addEventListener('click', (e) => {
		const accion = e.target.getAttribute('data-accion');
		accion_activo(accion);
	});

  //Funcion Aprobar Minuta Escrituracion

  const btn_aprobar_minuta = document.getElementById('btn-aprobar-minuta');

  btn_aprobar_minuta.addEventListener('click', (e) => {
    aprobar_minuta_fiducia()
  })

  function aprobar_minuta_fiducia() {		//OJO ACA SE VALIDA La minuta de escrituración
    let activo_pk = activo_id.value
    console.log("Validando Minuta de escrituración activo pk: ", activo_pk)
    const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

    swalWithBootstrapButtons.fire({
    title: '¿Desea pasar a aprobado la minuta de escrituración?',
    text: 'Una vez deje su observación, el activo quedará a cargo de la notaria que representa',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Si, aprobar!',
    cancelButtonText: 'No, envio observación!',
    reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        //
            let url = Urls.minuta_approved_notaria();  // URL to send message
            let form_data = new FormData();

            form_data.append("activo", {{ object.id }});
            form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
            
            fetch(url, {
              method: 'post',
              body: form_data
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              console.log("vienen datos de actualizacion ", data)
              if (data.status == 'success') {
                Swal.fire(
                      data.title,
                      data.message,
                      'success'
                ).then(() =>{
                  location.reload();
                });
              
              }else{
                Swal.fire(
                      'Error en red!',
                      'por favor recargue la pagina e intente de nuevo.',
                      'warning'
                    )
              }

            })
            .catch(error => {
              Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
            });
            //
        
      } else if (
        result.dismiss === Swal.DismissReason.cancel
      ){
        //
        Swal.fire({
        title: 'Mensaje al Sponsor',
        input: 'text',
        inputLabel: 'Digite la información para la Minuta',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        confirmButtonText: 'Enviar',
        showLoaderOnConfirm: true,
        preConfirm: (text) => {
          if (text) {
            console.log('Captured Text:', text);
            //
            let url = Urls.minuta_notario_message();  // URL to send message
            let form_data = new FormData();

            form_data.append("mensaje", text);
            form_data.append("activo", {{ object.id }});
            form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
            
            fetch(url, {
              method: 'post',
              body: form_data
            })
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              console.log("vienen datos de actualizacion ", data)
              if (data.status == 'success') {
                Swal.fire(
                      'Mensaje enviado!',
                      'Se ha enviado la novedad al sponsor.',
                      'success'
                ).then(() =>{
                  location.reload();
                });
              
              }else{
                Swal.fire(
                      'Error en red!',
                      'por favor recargue la pagina e intente de nuevo.',
                      'warning'
                    )
              }

            })
            .catch(error => {
              Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
            });
            //

          } else {
            Swal.showValidationMessage('Por favor digite sus observaciones');
          }
        },
        allowOutsideClick: () => !Swal.isLoading()
      })
        //
    
      }
    })
		
  }

  function accion_activo(accion) {		//OJO ACA SE COLOCA LA FUNCION PARA QUE INDIQUE LA NOTARIA QUE ARRANCA SU PROCESO
	  if (accion == 'tramitar_nueva_escritura') {
			const id_activo = activo_id.value;
			console.log('tramitar_nueva_escritura accion: ', id_activo);

			const swalWithBootstrapButtons = Swal.mixin({
        customClass: {
          confirmButton: 'btn btn-success',
          cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
      })

      swalWithBootstrapButtons.fire({
        title: '¿Desea comenzar el tramite notarial?',
        text: "Una vez comience el tramite, quedará pendiente de que haga el cargue de la nueva escritura",icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Si, empezar tramite!',
        cancelButtonText: 'No, cancelar!',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          //
              let url = Urls.tramitar_nueva_escritura();  // URL to send message
              let form_data = new FormData();

              form_data.append("activo", {{ object.id }});
              form_data.append("csrfmiddlewaretoken", '{{ csrf_token }}');
              
              fetch(url, {
                method: 'post',
                body: form_data
              })
              .then((response) => {
                return response.json();
              })
              .then((data) => {
                console.log("vienen datos de actualizacion ", data)
                if (data.status == 'success') {
                  Swal.fire(
                        data.title,
                        data.message,
                        'success'
                  ).then(() =>{
                    location.reload();
                  });
                
                }else{
                  Swal.fire(
                        'Error en red!',
                        'por favor recargue la pagina e intente de nuevo.',
                        'warning'
                      )
                }

              })
              .catch(error => {
                Swal.fire('Cancelado', 'Error en la accion por favor recargue la pagina e intente de nuevo', 'info');
              });
          //
          
        }
      })
		}
  }

  function subirArchivo() {  // FUNCION PARA ENVIAR LA NUEVA ESCRITURA DEL ACTIVO
    const formulario = document.querySelector('#addNuevaEscritura');
    const archivo = formulario.querySelector('input[type="file"]').files[0];
    const id_activo = document.getElementById('id_activo').value;

    // Validar que los campos no estén vacíos
    if (!archivo)
    {   
      Swal.fire({
        title: 'EL campo de Archivo escritura no debe estar vacio',
        text: 'Asegurese adjuntar el archivo una vez hecho esto el activo se enviará a Devise',
        icon: 'error',
        showConfirmButton: false,
      });
    } else {  
      const formData = new FormData();

      formData.append('id_activo', id_activo);
      formData.append('escritura', archivo);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
      let url = Urls.notaria_upload_escritura();  // URL to send file

      fetch(url, {
          method: 'POST',
          body: formData,
          
      })
      .then(response => response.json())
      .then(data => {
          console.log("vienen datos de actualizacion ", data)
            if (data.status == 'success') {
              Swal.fire(
                    data.title,
                    data.message,
                    'success'
              ).then(() =>{
                location.reload();
              });
            
            }else{
              Swal.fire(
                    'Error en red!',
                    'por favor recargue la pagina e intente de nuevo.',
                    'warning'
                  )
            }
      })
      .catch(error => {
          console.error('Error al subir archivo:', error);
      });
      
    }

    
  }


</script>
{% endblock %}
